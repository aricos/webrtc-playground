<!DOCTYPE html>
<html lang="en">
  <head>
    <title>webrtc playground</title>
    
    <style>
      .chat
      {
        position: absolute;
        top: 10px;
        right: 10px;
        max-width: 400px;
        background-color: #D99D86;
        border-radius: 5px;
        padding: 10px;
      }
      
      .chat header
      {
        border-bottom: 1px solid #836053;
        padding: 13px 0;
        margin-bottom: 8px;
      }
      
      .chat footer
      {
        border-top: 1px solid #836053;
        padding: 0 0;
      }
      
      .chat textarea
      {
        width: 100%;
        height: 4em;
        line-height: 1.5em;
      }
      
      .chat footer button
      {
        display: block;
        width: 100%;
        height: 40px;
        background-color: #f6b29b;
        border: 1px solid #6a4e45;
        border-radius: 5px;
      }

      .chat .messages
      {
        max-height: 200px;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      .chat .message
      {
        background-color: #D6D5D7;
        padding: 6px;
        border-radius: 5px;
        margin-bottom: 10px;
      }
      
      .chat .message pre, .chat .message p
      {
        margin: 0;
        padding: 0;
      }
      
      .chat .message.mine
      {
        text-align: right;
        background-color: #89CCD8;
      }
      
      .chat h3
      {
        padding: 0;
        margin: 0;
      }
    </style>
  </head>

  <body>
    <video id="localVideo" autoplay muted style="width:40%;"></video>
    <video id="remoteVideo" autoplay style="width:40%;"></video>

    <br />

    <input type="button" id="start" onclick="start(true)" value="Start Video"></input>


    <section class="chat">
      <header>
        <h3>Chat</h3>
      </header>
      <section id="chat-messages" class="messages">
      </section>
      <footer>
        <form id="chat-form">
        <textarea name="body"></textarea>
        <button>Send</button>
        </form>
      </footer>
    </section>


    <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
    <script src="websocket.js"></script>
    <script src="webrtc.js"></script>
    <script src="room.js"></script>
    <script src="chat.js"></script>    
    <script type="text/javascript">
      
      var messages = document.querySelector("#chat-messages")
      
      
      // chat controller
      
      var chatInput = new ChatInputController(document.querySelector("#chat-form"))
      
      var chatMessages = new ChatMessagesController(document.querySelector("#chat-messages"))
            
      chatInput.onmessage = function(message)
      {
        chatMessages.push(message)
      }
      

      // room
      
      var roomSettings = {
        
      }
      
      var room = createRoom(roomSettings)
      
      room.onconnect = function()
      {
        room.sendMessage("Hello there!")
      }
      
      room.onclose = function()
      {
        
      }
      
      room.onmessage = function(msg)
      {        
        var message = document.createElement("article")

        message.classList.add("message")
        
        if (msg.sender === room.uid)
        {
          message.classList.add("mine")
        }
        
        var p = document.createElement("p")
        
        p.innerText = msg.body
        
        message.appendChild(p)
        
        messages.appendChild(message)
        
        messages.scrollTo({
          top: messages.scrollHeight,
          left: 0,
          behavior: "smooth"
        })
      }
      
      document.addEventListener("DOMContentLoaded", function()
      {
        room.connect()
      })
      
      pageReady();
    </script>
  </body>
</html>